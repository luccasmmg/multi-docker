sudo: required
services:
- docker
before_install:
- docker build -t luccasmmg/react-test -f ./client/Dockerfile.dev ./client
script:
- docker run -e CI=true luccasmmg/react-test npm test -- --coverage
after_success:
- docker build -t luccasmmg/multi-client ./client
- docker build -t luccasmmg/multi-nginx ./nginx
- docker build -t luccasmmg/multi-server ./server
- docker build -t luccasmmg/multi-worker ./worker
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_ID" --password-stdin
- docker push luccasmmg/multi-client
- docker push luccasmmg/multi-nginx
- docker push luccasmmg/multi-server
- docker push luccasmmg/multi-worker
deploy:
  edge: true
  provider: elasticbeanstalk
  region: sa-east-1
  app: multi-docker
  env: MultiDocker-env
  bucket_name: elasticbeanstalk-sa-east-1-821626484152
  bucket_path: docker-multi
  on:
    branch: master
  access_key_id:
    secure: a8dD4jOGxvQnr3GhwvcayPidCUAqs+EMdxgKwftCJ2szpEcvJHn1f10q3unT1p1F09MBf5Fz9DGraysuscJ3nLPWAiwyqLXfcS/QHpOnR480UuWunb7Necq/2lH+hNK/1JwVAAtLqrm2LhR+lh+QbJj4eGxtrH4zQ+JASacQUMzOdn8v0eqccetjMZuiotlVWjlGPN1DbIpkVCTpA/01e4l3Zf7CI/tzQ8NYEpJUB4wWTT/kNA0cUCe+K08ippY+q6nnj7TNphyGgxMMDjgPn+ncKOGVU/OV1ea+osBpIEm4pQVMWrW2uCJniLZ9iO19c/hXiUIPdlwrNXhPFuERxZlY1UBB6Sev37hIA27ZUIT49QfMbh7fxKmQwhWvVeuWAQO03quA4jL34WaWFNSSyYLNI+kak8XesfzEpedOoBJJovZ9kB8cPspYbIRF5INKr4bRVEI3H6ndkiieyzPmGTOzeskhm6umKTyVVXoe9S/zS5ENB5zMNieDPocWJ04iGASTlpozf5wQDwLP/Kq4mg0ZyQ34Dk3ApwsHfJHuZH1DcyiZ1SyjdG0ihISQyuC4rxU4RxgodD7zrIHPejKtlAV+fiTjse3oza6eJ6KTd6GVyGHJJ5LMMob5x1XxXy0BgDnWJ2kJ6MB5fDDI4XV3UX6d7o+b7an4ksYz7UN64Yg=
  secret_access_key:
    secure: NXoD5DO4GA1/QCRMCmfMtWKvXvlDeoVevZdDeDa7BufYEk1spVRgu2VhYr/W0hz0zgl2uCNzEWTUBlxZMCyRWy3rfrr/51GIIqx0WAMXUK+qjlcbZ7AJ1hrRSzTWlTGip8F6wj7+IC37e1/wglz4BJFJH4ioWXJ9EF3nrqn5+DfAwVq3gx8XxHYuR8t3qBmZDNxxx4JEdOVH+XcvdMjgQnZ79nNF/uWVuXEFhamOXtJ+c1tsG7Xxy0lw7G4poqn8lCuqhbcno3wdBF0MlcTpHfirkaJQKLu3k8AKR7LlFDXLwHH3KsxnWtKk+4tLpMHTPKTBhhHsZtW5mzIBEY0DB6kXOnekC8Jbf2HDlt9r0uFLLemH8lfm7fmF7cZE3mUMAZwNv2mM0ECt44eE367lGTh0TRjqSn1z8k4W/pkvBUyvXPO79Sjgl1D78Hpf3gSUMeaCvy4I6ILgz+5qxaR50ICXVwGJk1ARRQcxj2ov6lUoVl/+0Zo7kUT8URJN4xVGBck4h5NxhFkgNac4SefMPV1RT0PPu+RTxECAXgA2MMl4mBq/hZ9ruLXdlfOcoRCVPWw+eC/SvuLGfC4xNNIdiw9MsJ1zj6ypoFyDYmXFRyfoClTG3sMfKglBqJiUB9NidJGlf26FOfL6N1wC4qMFxCjXX5Q7ZQU683QMc/DpHBQ=
